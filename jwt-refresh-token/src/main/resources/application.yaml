spring:
  application:
    name: jwt-refresh-token

  # Database Configuration
  datasource:
    url: jdbc:postgresql://localhost:5432/jwt_refresh_token_db
    username: jwtuser
    password: jwtpass123
    driver-class-name: org.postgresql.Driver

  # JPA/Hibernate Configuration
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

  # Redis Configuration (Optional - for token blacklist)
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: ${REDIS_TIMEOUT:60000}

# Server Configuration
server:
  port: 8080

# JWT Configuration
auth:
  token:
    # Access token expiration (15 minutes = 900000ms)
    expirationInMils: ${JWT_EXPIRATION:900000}

    # JWT secret key (generate with: openssl rand -base64 32)
    jwtSecret: ${JWT_SECRET:7JnMqvDc8x2K9pLmNbVcXzAsFgHjKlPoIuYtRwQeWsZ=}

    # Refresh token sliding window expiration (30 days = 2592000000ms)
    refreshExpirationInMils: ${JWT_REFRESH_EXPIRATION:2592000000}

    # Refresh token absolute max lifetime (90 days = 7776000000ms)
    maxAbsoluteLifetimeInMils: ${JWT_MAX_ABSOLUTE_LIFETIME:7776000000}

    # Max active tokens per user (multi-device support)
    maxActiveTokensPerUser: ${JWT_MAX_ACTIVE_TOKENS_PER_USER:5}

    cleanup:
      # Blacklist cleanup job settings
      retentionHours: 12
      # Cleanup job interval in minutes
      intervalMinutes: 30

  # Cookie Configuration
  cookie:
    # Prevent JavaScript access (XSS protection)
    http-only: ${COOKIE_HTTP_ONLY:true}

    # HTTPS only (set to true in production)
    secure: ${COOKIE_SECURE:false}

    # CSRF protection (Strict/Lax/None)
    same-site: ${COOKIE_SAME_SITE:Lax}

    # Cookie available for all paths
    path: ${COOKIE_PATH:/}

    # Change to your domain in production
    domain: ${COOKIE_DOMAIN:localhost}

# CORS Configuration
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}
  allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS,PATCH}
  allowed-headers: ${CORS_ALLOWED_HEADERS:Authorization,Content-Type}
  allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}

# Base API Path
app:
  defaults:
    base-path: ${API_BASE_PATH:/api/auth}

# Logging Configuration
logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    io.fayupable.jwtrefreshtoken: DEBUG

---
# Docker Profile
spring:
  config:
    activate:
      on-profile: docker

  datasource:
    url: jdbc:postgresql://postgres:5432/jwt_refresh_token_db
    username: jwt_refresh_token_user
    password: jwt_refresh_token_pass123

  data:
    redis:
      host: redis
      port: 6379

  jpa:
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        use_sql_comments: false

  # Cookie config for Docker
auth:
  cookie:
    domain: localhost  # Or service name in docker network
    secure: false      # Still false in docker dev environment

logging:
  level:
    org.hibernate.SQL: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: INFO
    io.fayupable.jwtrefreshtoken: INFO